{% if jekyll.environment == "production" and site.google_analytics and site.google_analytics != "" %}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
  <script>
    // Respect Do Not Track
    var dnt = (navigator.doNotTrack == "1" || window.doNotTrack == "1" || navigator.msDoNotTrack == "1");
    if (!dnt) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}

      // Optional: consent defaults (adjust to taste)
      gtag('consent', 'default', {
        ad_user_data: 'denied',
        ad_personalization: 'denied',
        ad_storage: 'denied',
        analytics_storage: 'granted'
      });

      gtag('js', new Date());
      gtag('config', '{{ site.google_analytics }}', { anonymize_ip: true });
    }
  </script>
{% endif %}
