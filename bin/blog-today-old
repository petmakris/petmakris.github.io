#!/usr/bin/env bash

# set -euox pipefail

POSTS_DIR="$BLOG_HOME/_posts"
mkdir -p "$POSTS_DIR"

LC_TIME_DEFAULT="el_GR.UTF-8"

TODAY_FILENAME="$(date +%Y-%m-%d)"
DATE_DIR="$TODAY_FILENAME"

TITLE="$(LC_TIME=$LC_TIME_DEFAULT date +"%A %e %B %Y" | sed 's/  */ /g')"

FILEPATH="$POSTS_DIR/$TODAY_FILENAME-notes.md"
if [[ -e "$FILEPATH" ]]; then
  ${EDITOR:-vim} "$FILEPATH"
  exit 1
fi

cat > "$FILEPATH" <<'EOF'
---
layout: post
title: TITLE
date: DATE_DIR
cal:
  deficit: 
  intake: 
  tdee: 
  active: 0
  weight: 
---

## Διατροφή

- γιαούρτι

<!---  ![pic](/pics/TODAY_FILENAME/yogurt.jpg)<br> -->
EOF

safe_sed() { sed -i "s|$1|$(printf '%s' "$2" | sed 's/[&/\]/\\&/g')|g" "$FILEPATH"; }
safe_sed "TITLE" "$TITLE"
safe_sed "TODAY_FILENAME" "$TODAY_FILENAME"
safe_sed "DATE_DIR" "$DATE_DIR"

echo "Created: $FILEPATH"

${EDITOR:-vim} "$FILEPATH"

